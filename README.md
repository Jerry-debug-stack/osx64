# 一个简易的IA32e(64位)多核操作系统的实现  
## 操作系统
### 前言  
想做一个可以操控AHCI，支持FAT32文件系统的多核OS，主要目标就是实现内核内存分配，进程调度，硬件管理以及最重要的VFS  
当然，再此基础上希望完善父子进程，管道和TTY相关的内容  
比较远期的想法是完善一套编译工具链，能够编译一些应用程序 ~~能够自己编译自己(我也很想这样，但是太难了，如果能够移植gcc的话)~~  
***
### 任务列表
- [x] 初始化工程
    - [x] 进入64位保护模式
      - [x] ld链接器语法
      - [x] multiboot标准
      - [x] 制作一个可以启动的程序
      - [x] 分页
      - [x] 模式切换
    - [x] 开始使用C语言
      - [x] 重写linker.ld,让我们的其余内核程序加载到高地址
      - [x] 从低地址跳转到高地址再跳转到内核
- [x] 内存管理
    - [x] 获取multiboot信息表
      - [x] 构建物理区域内存池
    - [x] 按页分配内存
      - [x] 引用计数的设计
      - [x] physic_page_alloc decreasze_reference_page_4k add_reference_4k
      - [x] alloc free物理连续的内存页
    - [x] 页表
      - [x] 创建页表中的一个4k页
      - [x] 回收页表中的一个4k页
      - [x] 创建页表中的一个2M页(这玩意只有内核映射会用到，且不用返还内存)
      - [x] 地址空间的划分
    - [x] arena分配器
      - [x] 初始化arena区域
      - [x] 小型arena区域
      - [x] 中型arena区域
    - [x] 堆分配器
      - [x] 堆初始化
      - [x] 堆中分配
      - [x] 堆中放回
- [x] VGA简单显示初步
    - [x] 获取VGA信息
    - [x] 简单的清屏幕，输出，定位，换行，换页的处理
    - [x] printf
- [x] 保护模式高级
    - [x] 重建GDT
    - [x] 中断与异常处理程序
    - [x] 重建IDT
- [x] APIC中断控制器与IOAPIC
    - [x] PCI总线初步(只是为了获取APIC寄存器地址)
    - [x] Local APIC
    - [x] IOAPIC
    - [x] 时钟滴答声
    - [x] 键盘驱动初步
    - [ ] 让其他核不再睡眠
        - [x] 查找madt,建立映射
            - [x] 查找madt
            - [x] 逻辑apic表(对于核数不多,可以线性查找,多了就二分查找)
        - [x] 其他核心的启动程序
        - [x] IPI消息
        - [x] 有序初始化它们的GDT与IDT
        - [x] prevent fault
- [ ] 进程调度器初步
    - [ ] 设计进程结构和PCB
    - [ ] 尝试一次进程切换
    - [ ] 构建一个列表，按照顺序进行切换
        - [ ] 锁
    - [ ] 多核心下的进程切换
        - [ ] 数据结构设计
        - [ ] 分发时钟中断
        - [ ] 多核切换
    - [ ] 系统调用
    - [ ] 进程exit
    - [ ] 进程fork
    - [ ] 多核心下的负载均衡
- [ ] PCI总线
    - [ ] PCI设备树
    - [ ] AHCI硬盘驱动初步
      - [ ] Detect一个AHCI
      - [ ] AHCI读写
- [ ] 文件系统
    - [ ] 选择一个我们想要的文件系统
    - [ ] VFS结构设计
      - [ ] VFS节点结构
      - [ ] VFS锁结构
    - [ ] VFS功能实现  


就是这样了，上面的内容应该会逐步完成(一边做一边写)  
***
### 后记
我并不是一个信科的学生(只是一个学物理的)，所以肯定会有不完善之处，欢迎指正。  
重新造轮子不是因为它能带给我们经济效益亦或是面试考试的价值，我做这件事只是为了更深入地学习。(我之前写的一个在接近尾声时因为奇奇怪怪的问题会有VFS死锁，而且效率极低)  
纸上得来终觉浅，绝知此事要躬行
***
## 远期的想法
asm编译器(还在等待中)  
C编译器(不知道要等待多久了)  
简易链接器(恐怕要爷关更了)
